<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
<h:head>
    <title>Gesti√≥n de Productos</title>
    <h:outputStylesheet name="css/style.css"/>
</h:head>
<h:body>
    <div class="container">
        <div class="header">
            <h1>‚öôÔ∏è Gesti√≥n de Productos</h1>
            <div class="nav">
                <h:link value="Ver Tienda" outcome="index" styleClass="nav-link"/>
                <h:link value="Ver Carrito" outcome="carrito" styleClass="nav-link"/>
            </div>
        </div>
        
        <h:messages globalOnly="true" styleClass="messages" infoClass="info" errorClass="error" warnClass="warn"/>
        
        <!-- Formulario para agregar productos -->
        <div class="form-section">
            <h2>‚ûï Agregar Nuevo Producto</h2>
            <h:form id="nuevoProductoForm" styleClass="product-form">
                <div class="form-group">
                    <h:outputLabel for="nombre" value="Nombre del Producto:"/>
                    <h:inputText id="nombre" 
                                value="#{productBean.nuevoProducto.nombre}" 
                                required="true"
                                requiredMessage="El nombre es obligatorio"
                                placeholder="Ej: Laptop Dell XPS"/>
                    <h:message for="nombre" styleClass="error-message"/>
                </div>
                
                <div class="form-group">
                    <h:outputLabel for="descripcion" value="Descripci√≥n:"/>
                    <h:inputTextarea id="descripcion" 
                                    value="#{productBean.nuevoProducto.descripcion}" 
                                    required="true"
                                    requiredMessage="La descripci√≥n es obligatoria"
                                    placeholder="Descripci√≥n detallada del producto"
                                    rows="3"/>
                    <h:message for="descripcion" styleClass="error-message"/>
                </div>
                
                <div class="form-group">
                    <h:outputLabel for="precio" value="Precio (USD):"/>
                    <h:inputText id="precio" 
                                value="#{productBean.nuevoProducto.precio}" 
                                required="true"
                                requiredMessage="El precio es obligatorio"
                                placeholder="0.00">
                        <f:validateDoubleRange minimum="0.01"/>
                    </h:inputText>
                    <h:message for="precio" styleClass="error-message"/>
                </div>
                
                <div class="form-group">
                    <h:outputLabel for="stock" value="Cantidad en Stock:"/>
                    <h:inputText id="stock" 
                                value="#{productBean.nuevoProducto.stock}" 
                                required="true"
                                requiredMessage="El stock es obligatorio"
                                placeholder="0">
                        <f:validateLongRange minimum="0"/>
                    </h:inputText>
                    <h:message for="stock" styleClass="error-message"/>
                </div>
                
                <div class="form-actions">
                    <h:commandButton value="‚ûï Agregar Producto" 
                                   action="#{productBean.agregarProducto}" 
                                   styleClass="btn btn-primary">
                        <f:ajax execute="@form" render="@form :tablaProductos :headerMsg"/>
                    </h:commandButton>
                </div>
            </h:form>
        </div>
        
        <!-- Tabla de productos existentes -->
        <div class="table-section">
            <h2>üìã Lista de Productos (#{productBean.productos.size()} productos)</h2>
            <h:form id="tablaProductos">
                <div class="table-responsive">
                    <h:dataTable value="#{productBean.productos}" 
                                var="prod" 
                                styleClass="product-table"
                                headerClass="table-header"
                                rowClasses="table-row-odd,table-row-even">
                        <h:column>
                            <f:facet name="header">ID</f:facet>
                            #{prod.id}
                        </h:column>
                        
                        <h:column>
                            <f:facet name="header">Nombre</f:facet>
                            <h:inputText value="#{prod.nombre}" 
                                       rendered="#{productBean.productoSeleccionado.id == prod.id}"
                                       styleClass="edit-input"/>
                            <h:outputText value="#{prod.nombre}" 
                                        rendered="#{productBean.productoSeleccionado.id != prod.id}"/>
                        </h:column>
                        
                        <h:column>
                            <f:facet name="header">Descripci√≥n</f:facet>
                            <h:inputTextarea value="#{prod.descripcion}" 
                                           rendered="#{productBean.productoSeleccionado.id == prod.id}"
                                           styleClass="edit-textarea"
                                           rows="2"/>
                            <h:outputText value="#{prod.descripcion}" 
                                        rendered="#{productBean.productoSeleccionado.id != prod.id}"/>
                        </h:column>
                        
                        <h:column>
                            <f:facet name="header">Precio</f:facet>
                            <h:inputText value="#{prod.precio}" 
                                       rendered="#{productBean.productoSeleccionado.id == prod.id}"
                                       styleClass="edit-input edit-price">
                                <f:validateDoubleRange minimum="0.01"/>
                            </h:inputText>
                            <h:outputText value="$#{prod.precio}" 
                                        rendered="#{productBean.productoSeleccionado.id != prod.id}">
                                <f:convertNumber type="number" maxFractionDigits="2" minFractionDigits="2"/>
                            </h:outputText>
                        </h:column>
                        
                        <h:column>
                            <f:facet name="header">Stock</f:facet>
                            <h:inputText value="#{prod.stock}" 
                                       rendered="#{productBean.productoSeleccionado.id == prod.id}"
                                       styleClass="edit-input edit-stock">
                                <f:validateLongRange minimum="0"/>
                            </h:inputText>
                            <span rendered="#{productBean.productoSeleccionado.id != prod.id}"
                                  class="stock-badge-table #{prod.stock > 10 ? 'stock-ok' : prod.stock > 0 ? 'stock-low' : 'stock-out'}">
                                #{prod.stock}
                            </span>
                        </h:column>
                        
                        <h:column>
                            <f:facet name="header">Acciones</f:facet>
                            <div class="action-buttons">
                                <h:commandButton value="üóëÔ∏è Eliminar" 
                                               action="#{productBean.eliminarProducto(prod)}"
                                               styleClass="btn btn-danger btn-small"
                                               onclick="return confirm('¬øEst√° seguro de eliminar este producto?');"
                                               title="Eliminar producto">
                                    <f:ajax execute="@form" render="@form :headerMsg"/>
                                </h:commandButton>
                            </div>
                        </h:column>
                    </h:dataTable>
                </div>
            </h:form>
        </div>
    </div>
</h:body>
</html> value="‚úèÔ∏è Editar" 
                                               action="#{productBean.editarProducto(prod)}"
                                               styleClass="btn btn-secondary btn-small"
                                               rendered="#{productBean.productoSeleccionado.id != prod.id}"
                                               title="Editar producto">
                                    <f:ajax execute="@form" render="@form"/>
                                </h:commandButton>
                                <h:commandButton value="‚úì Guardar" 
                                               action="#{productBean.actualizarProducto()}"
                                               styleClass="btn btn-success btn-small"
                                               rendered="#{productBean.productoSeleccionado.id == prod.id}"
                                               title="Guardar cambios">
                                    <f:ajax execute="@form" render="@form :headerMsg"/>
                                </h:commandButton>
                                <h:commandButton
                                                  value="‚úñ Cancelar" 
                                                  action="#{productBean.cancelarEdicion()}"
                                                  styleClass="btn btn-warning btn-small"
                                                  rendered="#{productBean.productoSeleccionado.id == prod.id}"
                                                  title="Cancelar edici√≥n">
                                        <f:ajax execute="@form" render="@form"/>                                
                                </h:commandButton>
                            </div>
                        </h:column> 